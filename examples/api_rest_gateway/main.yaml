main: http_server
modules: 
  - module: http_server
  - module: http_request
steps:
  - condition:
      assert: !eval main.method == "POST"
    then:
      - !include authorizer.yaml
      - condition:
          assert: !eval steps.auth == true
        then:
          - use: http_request
            input:
              method: POST
              url: !eval main.url
              headers:
                Content-Type: application/json
                X-Transaction-ID: xxxx
              body: !include assets/body.yaml
          - return:
              status_code: 201
        else:
          - return:
              status_code: 401
              body: !include assets/401.yaml
    else:
      - use: http_request
        input:
          method: GET
          url: !eval main.url
          headers:
            Content-Type: application/json
            X-Transaction-ID: xxxx
          body: !include assets/body.yaml
      - return:
          status_code: 200